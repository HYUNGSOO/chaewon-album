<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ï±ÑÏõêÏù¥Ïùò ÏÑ±Ïû• Ïï®Î≤î üå∏</title>
    <link href="https://fonts.googleapis.com/css2?family=Jua&family=Nanum+Myeongjo:wght@400;700;800&family=Noto+Sans+KR:wght@300;400;500;700&display=swap" rel="stylesheet">
    <script src="https://accounts.google.com/gsi/client" async defer></script>
    <style>
        :root {
            --cream: #FAF7F0;
            --soft-beige: #E8DCC7;
            --warm-beige: #D4C4A8;
            --light-tan: #E5D9C5;
            --soft-tan: #DDD0BC;
            --sage: #B4C7B6;
            --text-dark: #4A4A4A;
            --text-light: #7A7A7A;
            --accent-beige: #C9B896;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Noto Sans KR', sans-serif;
            background: var(--cream);
            color: var(--text-dark);
            overflow-x: hidden;
        }

        /* Login Screen */
        .login-screen {
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            background: linear-gradient(135deg, var(--light-tan), var(--cream));
        }

        .login-box {
            background: white;
            padding: 60px 50px;
            border-radius: 30px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.15);
            text-align: center;
            max-width: 450px;
        }

        .login-box h1 {
            font-family: 'Jua', sans-serif;
            font-size: 3em;
            color: var(--text-dark);
            margin-bottom: 20px;
        }

        .login-box p {
            color: var(--text-light);
            font-size: 1.2em;
            margin-bottom: 40px;
        }

        .google-login-btn {
            background: white;
            border: 2px solid var(--warm-beige);
            padding: 15px 40px;
            border-radius: 50px;
            font-size: 1.1em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            display: inline-flex;
            align-items: center;
            gap: 10px;
        }

        .google-login-btn:hover {
            background: var(--light-tan);
            transform: scale(1.05);
        }

        .main-content {
            display: none;
        }

        .main-content.show {
            display: block;
        }

        /* Navigation */
        nav {
            position: fixed;
            top: 0;
            width: 100%;
            background: rgba(250, 247, 240, 0.95);
            backdrop-filter: blur(10px);
            z-index: 1000;
            border-bottom: 1px solid var(--warm-beige);
        }

        nav ul {
            display: flex;
            justify-content: center;
            gap: 40px;
            padding: 20px;
            list-style: none;
        }

        nav a {
            color: var(--text-dark);
            text-decoration: none;
            font-weight: 500;
            transition: color 0.3s;
        }

        nav a:hover {
            color: var(--accent-beige);
        }

        .logout-btn {
            position: absolute;
            right: 20px;
            top: 50%;
            transform: translateY(-50%);
            background: var(--accent-beige);
            color: white;
            border: none;
            padding: 8px 20px;
            border-radius: 20px;
            cursor: pointer;
            font-size: 0.9em;
            transition: background 0.3s;
        }

        .logout-btn:hover {
            background: var(--warm-beige);
        }

        /* Hero Section */
        .hero {
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            text-align: center;
            padding: 100px 20px 50px;
            background: 
                radial-gradient(circle at 20% 80%, var(--soft-tan) 0%, transparent 50%),
                radial-gradient(circle at 80% 20%, var(--light-tan) 0%, transparent 50%),
                var(--cream);
            position: relative;
        }

        .hero::before {
            content: '‚ú®';
            position: absolute;
            top: 15%;
            left: 15%;
            font-size: 3em;
            opacity: 0.3;
            animation: float 6s ease-in-out infinite;
        }

        .hero::after {
            content: 'üå∏';
            position: absolute;
            bottom: 20%;
            right: 15%;
            font-size: 2.5em;
            opacity: 0.3;
            animation: float 5s ease-in-out infinite 1s;
        }

        @keyframes float {
            0%, 100% { transform: translateY(0px) rotate(0deg); }
            50% { transform: translateY(-20px) rotate(10deg); }
        }

        .hero-content h1 {
            font-family: 'Jua', sans-serif;
            font-size: 5em;
            color: var(--text-dark);
            margin-bottom: 20px;
            font-weight: 400;
        }

        .hero-content .subtitle {
            font-family: 'Nanum Myeongjo', serif;
            font-size: 1.8em;
            color: var(--text-light);
            margin-bottom: 40px;
        }

        .days-counter {
            background: white;
            padding: 40px 60px;
            border-radius: 30px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.08);
            display: inline-block;
            margin-top: 20px;
        }

        .days-number {
            font-size: 4em;
            font-weight: 700;
            color: var(--accent-beige);
            font-family: 'Jua', sans-serif;
        }

        .days-text {
            font-size: 1.2em;
            color: var(--text-light);
            margin-top: 10px;
        }

        /* Milestones Section */
        .milestones {
            padding: 100px 20px;
            background: white;
        }

        .section-title {
            font-family: 'Jua', sans-serif;
            font-size: 3.5em;
            text-align: center;
            margin-bottom: 60px;
            color: var(--text-dark);
        }

        .milestone-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 30px;
            max-width: 1200px;
            margin: 0 auto;
        }

        .milestone-card {
            background: linear-gradient(135deg, var(--light-tan) 0%, var(--soft-tan) 100%);
            padding: 40px 30px;
            border-radius: 25px;
            text-align: center;
            transition: transform 0.3s, box-shadow 0.3s;
            cursor: pointer;
            position: relative;
            overflow: hidden;
        }

        .milestone-card:hover {
            transform: translateY(-10px);
            box-shadow: 0 15px 40px rgba(0,0,0,0.12);
        }

        .milestone-photo {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            object-fit: cover;
            opacity: 0;
            transition: opacity 0.3s;
            z-index: 1;
        }

        .milestone-card:hover .milestone-photo {
            opacity: 1;
        }

        .milestone-content {
            position: relative;
            z-index: 2;
            transition: opacity 0.3s;
        }

        .milestone-card:hover .milestone-content {
            opacity: 0;
        }

        .milestone-edit-btn {
            position: absolute;
            top: 10px;
            right: 10px;
            background: white;
            border: none;
            width: 35px;
            height: 35px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 1.2em;
            z-index: 3;
            opacity: 0;
            transition: opacity 0.3s;
        }

        .milestone-card:hover .milestone-edit-btn {
            opacity: 1;
        }

        .milestone-icon {
            font-size: 3em;
            margin-bottom: 15px;
        }

        .milestone-name {
            font-size: 1.5em;
            font-weight: 700;
            margin-bottom: 10px;
            color: var(--text-dark);
        }

        .milestone-date {
            font-size: 1.1em;
            color: var(--text-light);
            font-family: 'Nanum Myeongjo', serif;
        }

        .milestone-days {
            font-size: 0.9em;
            color: var(--text-light);
            margin-top: 5px;
        }

        /* Gallery Section */
        .gallery {
            padding: 100px 20px;
            background: var(--cream);
        }

        .upload-area {
            max-width: 800px;
            margin: 0 auto 50px;
            background: white;
            padding: 40px;
            border-radius: 25px;
            border: 3px dashed var(--warm-beige);
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
        }

        .upload-area:hover {
            border-color: var(--accent-beige);
            background: var(--light-tan);
        }

        .upload-icon {
            font-size: 4em;
            margin-bottom: 20px;
        }

        .upload-text {
            font-size: 1.2em;
            color: var(--text-light);
        }

        .gallery-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 25px;
            max-width: 1400px;
            margin: 0 auto;
        }

        .gallery-item {
            position: relative;
            border-radius: 20px;
            overflow: hidden;
            box-shadow: 0 5px 20px rgba(0,0,0,0.1);
            transition: transform 0.3s;
            background: white;
            padding: 15px;
            cursor: move;
        }

        .gallery-item:hover {
            transform: scale(1.05);
        }

        .gallery-item.dragging {
            opacity: 0.5;
            transform: scale(1.1);
        }

        .gallery-item.drag-over {
            border: 3px dashed var(--accent-beige);
        }

        .gallery-item img {
            width: 100%;
            height: 250px;
            object-fit: cover;
            border-radius: 15px;
        }

        .gallery-item video {
            width: 100%;
            height: 250px;
            object-fit: cover;
            border-radius: 15px;
        }

        .gallery-info {
            padding: 15px 10px;
            text-align: center;
        }

        .gallery-date {
            font-size: 0.9em;
            color: var(--text-light);
            font-family: 'Nanum Myeongjo', serif;
        }

        .gallery-caption {
            margin-top: 8px;
            font-size: 1em;
            color: var(--text-dark);
        }

        .gallery-edit-btn {
            position: absolute;
            top: 25px;
            right: 25px;
            background: white;
            border: none;
            width: 35px;
            height: 35px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 1em;
            z-index: 10;
            opacity: 0;
            transition: opacity 0.3s;
            box-shadow: 0 2px 10px rgba(0,0,0,0.2);
        }

        .gallery-item:hover .gallery-edit-btn {
            opacity: 1;
        }

        .gallery-delete-btn {
            position: absolute;
            top: 25px;
            right: 70px;
            background: white;
            border: none;
            width: 35px;
            height: 35px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 1em;
            z-index: 10;
            opacity: 0;
            transition: opacity 0.3s;
            box-shadow: 0 2px 10px rgba(0,0,0,0.2);
        }

        .gallery-item:hover .gallery-delete-btn {
            opacity: 1;
        }

        /* Pagination */
        .pagination {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 10px;
            margin-top: 40px;
        }

        .page-btn {
            background: white;
            border: 2px solid var(--warm-beige);
            padding: 10px 15px;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 1em;
            min-width: 40px;
        }

        .page-btn:hover {
            border-color: var(--accent-beige);
            background: var(--light-tan);
        }

        .page-btn.active {
            background: var(--accent-beige);
            color: white;
            border-color: var(--accent-beige);
        }

        .page-btn:disabled {
            opacity: 0.3;
            cursor: not-allowed;
        }

        /* Gallery Management Section */
        .gallery-manage {
            padding: 100px 20px;
            background: white;
        }

        .manage-controls {
            max-width: 1400px;
            margin: 0 auto 40px;
            display: flex;
            gap: 20px;
            flex-wrap: wrap;
            align-items: center;
        }

        .search-box {
            flex: 1;
            min-width: 200px;
        }

        .search-box input {
            width: 100%;
            padding: 12px 20px;
            border: 2px solid var(--warm-beige);
            border-radius: 15px;
            font-size: 1em;
        }

        .view-toggle {
            display: flex;
            gap: 10px;
        }

        .view-btn {
            padding: 10px 20px;
            border: 2px solid var(--warm-beige);
            background: white;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .view-btn.active {
            background: var(--accent-beige);
            color: white;
            border-color: var(--accent-beige);
        }

        .manage-list {
            max-width: 1400px;
            margin: 0 auto;
        }

        .list-item {
            background: white;
            border: 2px solid var(--warm-beige);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 15px;
            display: flex;
            gap: 20px;
            align-items: center;
            transition: all 0.3s;
        }

        .list-item:hover {
            border-color: var(--accent-beige);
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .list-thumbnail {
            width: 120px;
            height: 120px;
            border-radius: 10px;
            object-fit: cover;
            flex-shrink: 0;
        }

        .list-info {
            flex: 1;
        }

        .list-filename {
            font-size: 1.2em;
            font-weight: 600;
            margin-bottom: 8px;
            color: var(--text-dark);
        }

        .list-meta {
            color: var(--text-light);
            font-size: 0.95em;
            margin-bottom: 5px;
        }

        .list-caption {
            color: var(--text-dark);
            margin-top: 10px;
        }

        .list-actions {
            display: flex;
            gap: 10px;
            flex-shrink: 0;
        }

        .action-btn {
            padding: 10px 20px;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            font-size: 0.95em;
            transition: transform 0.2s;
        }

        .action-btn:hover {
            transform: scale(1.05);
        }

        .btn-edit {
            background: var(--accent-beige);
            color: white;
        }

        .btn-delete {
            background: #f4d9d0;
            color: var(--text-dark);
        }

        /* Timeline Section */
        .timeline {
            padding: 100px 20px;
            background: white;
        }

        .timeline-container {
            max-width: 900px;
            margin: 0 auto;
            position: relative;
        }

        .timeline-container::before {
            content: '';
            position: absolute;
            left: 50%;
            transform: translateX(-50%);
            width: 3px;
            height: 100%;
            background: var(--warm-beige);
        }

        .timeline-item {
            margin-bottom: 50px;
            position: relative;
        }

        .timeline-item:nth-child(odd) {
            padding-right: 50%;
            text-align: right;
        }

        .timeline-item:nth-child(even) {
            padding-left: 50%;
        }

        .timeline-content {
            background: var(--light-tan);
            padding: 25px;
            border-radius: 20px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.08);
            position: relative;
        }

        .timeline-edit-btns {
            position: absolute;
            top: 10px;
            right: 10px;
            display: flex;
            gap: 5px;
            opacity: 0;
            transition: opacity 0.3s;
        }

        .timeline-content:hover .timeline-edit-btns {
            opacity: 1;
        }

        .timeline-edit-btn, .timeline-delete-btn {
            background: white;
            border: none;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 0.9em;
            transition: transform 0.2s;
        }

        .timeline-edit-btn:hover, .timeline-delete-btn:hover {
            transform: scale(1.1);
        }

        .timeline-add-btn {
            background: var(--accent-beige);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 15px;
            font-size: 1.1em;
            font-weight: 600;
            cursor: pointer;
            margin: 30px auto;
            display: block;
            transition: background 0.3s;
        }

        .timeline-add-btn:hover {
            background: var(--warm-beige);
        }

        .timeline-dot {
            position: absolute;
            left: 50%;
            transform: translateX(-50%);
            width: 20px;
            height: 20px;
            background: var(--accent-beige);
            border-radius: 50%;
            border: 4px solid white;
            box-shadow: 0 0 0 3px var(--warm-beige);
        }

        .timeline-date {
            font-weight: 700;
            color: var(--text-dark);
            margin-bottom: 10px;
        }

        .timeline-text {
            color: var(--text-light);
            line-height: 1.6;
        }

        /* Photo Slideshow */
        .hero-slideshow {
            max-width: 900px;
            margin: 60px auto 0;
            position: relative;
        }

        .slideshow-container {
            position: relative;
            height: 400px;
            border-radius: 30px;
            overflow: hidden;
            box-shadow: 0 20px 60px rgba(0,0,0,0.15);
        }

        .slide {
            display: none;
            width: 100%;
            height: 100%;
            position: absolute;
            animation: fadeIn 1s;
        }

        .slide.active {
            display: block;
        }

        .slide img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .slide-placeholder {
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, var(--light-tan), var(--soft-tan));
            display: flex;
            align-items: center;
            justify-content: center;
            flex-direction: column;
            color: white;
        }

        .slide-placeholder-icon {
            font-size: 5em;
            margin-bottom: 20px;
        }

        .slide-placeholder-text {
            font-size: 1.5em;
            font-family: 'Jua', sans-serif;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .slide-nav {
            position: absolute;
            top: 50%;
            transform: translateY(-50%);
            background: rgba(255, 255, 255, 0.8);
            border: none;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            font-size: 1.5em;
            cursor: pointer;
            transition: all 0.3s;
            z-index: 10;
        }

        .slide-nav:hover {
            background: white;
            transform: translateY(-50%) scale(1.1);
        }

        .slide-nav.prev {
            left: 20px;
        }

        .slide-nav.next {
            right: 20px;
        }

        .slide-dots {
            text-align: center;
            margin-top: 20px;
        }

        .dot {
            display: inline-block;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: var(--warm-beige);
            margin: 0 5px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .dot.active {
            background: var(--accent-beige);
            transform: scale(1.3);
        }

        /* Loading Indicator */
        .loading {
            text-align: center;
            padding: 40px;
            color: var(--text-light);
        }

        .spinner {
            border: 4px solid var(--warm-beige);
            border-top: 4px solid var(--accent-beige);
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Modal Styles */
        .modal {
            display: none;
            position: fixed;
            z-index: 2000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            animation: fadeIn 0.3s;
        }

        .modal.show {
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .modal-content {
            background: white;
            padding: 40px;
            border-radius: 25px;
            max-width: 500px;
            width: 90%;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        }

        .modal-title {
            font-family: 'Jua', sans-serif;
            font-size: 2em;
            margin-bottom: 20px;
            text-align: center;
            color: var(--text-dark);
        }

        .modal-form {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .modal-form label {
            font-weight: 600;
            color: var(--text-dark);
            margin-bottom: 5px;
        }

        .modal-form input, .modal-form textarea {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid var(--warm-beige);
            border-radius: 12px;
            font-size: 1em;
            font-family: 'Noto Sans KR', sans-serif;
        }

        .modal-form textarea {
            min-height: 100px;
            resize: vertical;
        }

        .modal-buttons {
            display: flex;
            gap: 10px;
            margin-top: 10px;
        }

        .modal-btn {
            flex: 1;
            padding: 12px;
            border: none;
            border-radius: 12px;
            font-size: 1em;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s;
        }

        .modal-btn:hover {
            transform: scale(1.02);
        }

        .modal-btn-primary {
            background: var(--accent-beige);
            color: white;
        }

        .modal-btn-secondary {
            background: var(--warm-beige);
            color: var(--text-dark);
        }

        .file-upload-btn {
            background: var(--light-tan);
            color: var(--text-dark);
            padding: 12px;
            border-radius: 12px;
            cursor: pointer;
            text-align: center;
            font-weight: 600;
            transition: background 0.3s;
        }

        .file-upload-btn:hover {
            background: var(--soft-tan);
        }

        .photo-preview {
            max-width: 100%;
            max-height: 200px;
            border-radius: 12px;
            margin-top: 10px;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .hero-content h1 {
                font-size: 3em;
            }

            .days-counter {
                padding: 30px 40px;
            }

            .days-number {
                font-size: 3em;
            }

            nav ul {
                gap: 20px;
                font-size: 0.9em;
            }

            .timeline-container::before {
                left: 20px;
            }

            .timeline-item:nth-child(odd),
            .timeline-item:nth-child(even) {
                padding-left: 60px;
                padding-right: 0;
                text-align: left;
            }

            .timeline-dot {
                left: 20px;
            }

            .slideshow-container {
                height: 300px;
            }

            .logout-btn {
                position: static;
                transform: none;
                margin: 10px auto;
                display: block;
            }
        }

        /* Footer */
        footer {
            background: var(--text-dark);
            color: var(--cream);
            text-align: center;
            padding: 40px 20px;
            font-family: 'Nanum Myeongjo', serif;
        }

        footer p {
            margin-bottom: 10px;
        }
    </style>
</head>
<body>
    <!-- Login Screen -->
    <div id="loginScreen" class="login-screen">
        <div class="login-box">
            <h1>Ï±ÑÏõêÏù¥Ïùò ÏÑ±Ïû• Ïï®Î≤î</h1>
            <p>Google Í≥ÑÏ†ïÏúºÎ°ú Î°úÍ∑∏Ïù∏ÌïòÏó¨<br>ÏÜåÏ§ëÌïú Ï∂îÏñµÏùÑ Ï†ÄÏû•ÌïòÏÑ∏Ïöî</p>
            <button class="google-login-btn" onclick="handleGoogleLogin()">
                <svg width="24" height="24" viewBox="0 0 24 24">
                    <path fill="#4285F4" d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"/>
                    <path fill="#34A853" d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"/>
                    <path fill="#FBBC05" d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"/>
                    <path fill="#EA4335" d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"/>
                </svg>
                GoogleÎ°ú Î°úÍ∑∏Ïù∏
            </button>
        </div>
    </div>

    <!-- Main Content -->
    <div id="mainContent" class="main-content">
        <!-- Navigation -->
        <nav>
            <ul>
                <li><a href="#hero">Ìôà</a></li>
                <li><a href="#milestones">Í∏∞ÎÖêÏùº</a></li>
                <li><a href="#gallery">Ïï®Î≤î</a></li>
                <li><a href="#timeline">ÌÉÄÏûÑÎùºÏù∏</a></li>
            </ul>
            <button class="logout-btn" onclick="handleLogout()">Î°úÍ∑∏ÏïÑÏõÉ</button>
        </nav>

        <!-- Hero Section -->
        <section id="hero" class="hero">
            <div class="hero-content">
                <h1>Ï±ÑÏõêÏù¥Ïùò ÏÑ±Ïû• Ïï®Î≤î</h1>
                <p class="subtitle">2025ÎÖÑ 9Ïõî 30Ïùº ÌÉúÏñ¥ÎÇú Ïö∞Î¶¨ ÏïÑÍ∏∞</p>
                <div class="days-counter">
                    <div class="days-number" id="daysCount">0</div>
                    <div class="days-text">ÏùºÏß∏ Ìï®ÍªòÌïòÎäî Ï§ë üíï</div>
                </div>
                
                <!-- Photo Slideshow -->
                <div class="hero-slideshow">
                    <div class="slideshow-container" id="slideshowContainer">
                        <button class="slide-nav prev" onclick="changeSlide(-1)">‚ùÆ</button>
                        <button class="slide-nav next" onclick="changeSlide(1)">‚ùØ</button>
                    </div>
                    <div class="slide-dots" id="slideDots"></div>
                </div>
            </div>
        </section>

        <!-- Milestones Section -->
        <section id="milestones" class="milestones">
            <h2 class="section-title">ÏÜåÏ§ëÌïú Í∏∞ÎÖêÏùºÎì§</h2>
            <div class="milestone-grid" id="milestoneGrid"></div>
        </section>

        <!-- Gallery Section -->
        <section id="gallery" class="gallery">
            <h2 class="section-title">ÏÇ¨ÏßÑ & ÎèôÏòÅÏÉÅ Ïï®Î≤î</h2>
            
            <div style="text-align: center; margin-bottom: 30px;">
                <a href="chaewon_album_manage.html" target="_blank" style="display: inline-block; background: var(--accent-beige); color: white; padding: 15px 40px; border-radius: 15px; text-decoration: none; font-size: 1.1em; font-weight: 600; transition: transform 0.3s;" onmouseover="this.style.transform='scale(1.05)'" onmouseout="this.style.transform='scale(1)'">
                    üõ†Ô∏è Ïï®Î≤î Í¥ÄÎ¶¨ ÌéòÏù¥ÏßÄ Ïó¥Í∏∞
                </a>
            </div>

            <div class="upload-area" onclick="document.getElementById('fileInput').click()">
                <div class="upload-icon">üì∏</div>
                <div class="upload-text">ÌÅ¥Î¶≠Ìï¥ÏÑú ÏÇ¨ÏßÑÏù¥ÎÇò ÎèôÏòÅÏÉÅ Ï∂îÍ∞ÄÌïòÍ∏∞</div>
                <input type="file" id="fileInput" accept="image/*,video/*" multiple style="display: none;">
            </div>

            <div id="galleryLoading" class="loading" style="display: none;">
                <div class="spinner"></div>
                <p>ÏÇ¨ÏßÑÏùÑ Î∂àÎü¨Ïò§Îäî Ï§ë...</p>
            </div>

            <div class="gallery-grid" id="galleryGrid"></div>

            <div class="pagination" id="galleryPagination"></div>
        </section>

        <!-- Timeline Section -->
        <section id="timeline" class="timeline">
            <h2 class="section-title">Ï±ÑÏõêÏù¥Ïùò Ïù¥ÏïºÍ∏∞</h2>
            <button class="timeline-add-btn" onclick="showAddTimelineModal()">+ ÏÉà Ïù¥ÏïºÍ∏∞ Ï∂îÍ∞Ä</button>
            <div class="timeline-container" id="timelineContainer"></div>
        </section>

        <!-- Footer -->
        <footer>
            <p>üíï Ï±ÑÏõêÏù¥ÏôÄ Ìï®ÍªòÌïòÎäî Î™®Îì† ÏàúÍ∞ÑÏù¥ ÏÜåÏ§ëÌï©ÎãàÎã§ üíï</p>
            <p>Made with Love | Google DriveÎ°ú ÏïàÏ†ÑÌïòÍ≤å Ï†ÄÏû•Îê©ÎãàÎã§</p>
        </footer>
    </div>

    <!-- Modals -->
    <!-- Milestone Photo Modal -->
    <div id="milestoneModal" class="modal">
        <div class="modal-content">
            <h3 class="modal-title">Í∏∞ÎÖêÏùº ÏÇ¨ÏßÑ Ï∂îÍ∞Ä</h3>
            <div class="modal-form">
                <div>
                    <label class="file-upload-btn" for="milestonePhotoInput">
                        üì∏ ÏÇ¨ÏßÑ ÏÑ†ÌÉùÌïòÍ∏∞
                    </label>
                    <input type="file" id="milestonePhotoInput" accept="image/*" style="display: none;">
                    <img id="milestonePhotoPreview" class="photo-preview" style="display: none;">
                </div>
                <div class="modal-buttons">
                    <button class="modal-btn modal-btn-secondary" onclick="closeMilestoneModal()">Ï∑®ÏÜå</button>
                    <button class="modal-btn modal-btn-primary" onclick="saveMilestonePhoto()">Ï†ÄÏû•</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Timeline Edit Modal -->
    <div id="timelineModal" class="modal">
        <div class="modal-content">
            <h3 class="modal-title" id="timelineModalTitle">Ïù¥ÏïºÍ∏∞ Ï∂îÍ∞Ä</h3>
            <div class="modal-form">
                <div>
                    <label>ÎÇ†Ïßú</label>
                    <input type="date" id="timelineDate">
                </div>
                <div>
                    <label>ÎÇ¥Ïö©</label>
                    <textarea id="timelineText" placeholder="Ïò§Îäò ÏûàÏóàÎçò ÏùºÏùÑ Ï†ÅÏñ¥Î≥¥ÏÑ∏Ïöî..."></textarea>
                </div>
                <div class="modal-buttons">
                    <button class="modal-btn modal-btn-secondary" onclick="closeTimelineModal()">Ï∑®ÏÜå</button>
                    <button class="modal-btn modal-btn-primary" onclick="saveTimelineEvent()">Ï†ÄÏû•</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Gallery Edit Modal -->
    <div id="galleryEditModal" class="modal">
        <div class="modal-content">
            <h3 class="modal-title" id="galleryEditModalTitle">ÏÇ¨ÏßÑ Ï†ïÎ≥¥ ÏàòÏ†ï</h3>
            <div class="modal-form">
                <div>
                    <label>ÎÇ†Ïßú</label>
                    <input type="date" id="galleryEditDate">
                </div>
                <div>
                    <label>ÏÑ§Î™Ö</label>
                    <input type="text" id="galleryEditCaption" placeholder="ÏÇ¨ÏßÑ ÏÑ§Î™ÖÏùÑ ÏûÖÎ†•ÌïòÏÑ∏Ïöî...">
                </div>
                <div class="modal-buttons">
                    <button class="modal-btn modal-btn-secondary" onclick="closeGalleryEditModal()">Ï∑®ÏÜå</button>
                    <button class="modal-btn modal-btn-primary" onclick="saveGalleryEdit()">Ï†ÄÏû•</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ==========================================
        // Google Drive ÏÑ§Ï†ï - Ïó¨Í∏∞Ïóê ÏûÖÎ†•ÌïòÏÑ∏Ïöî!
        // ==========================================
        const GOOGLE_CLIENT_ID = '373129025440-4ats7v4ec2kvgtemdtbqdn5njmuud2n0.apps.googleusercontent.com';
        const GOOGLE_API_KEY = '';  // API KeyÎäî ÌïÑÏöî ÏóÜÏäµÎãàÎã§
        const GOOGLE_FOLDER_ID = '1OPv9ZA9tYuyVk1kxlqOYA7tosmRKE0S7';

        
        const DISCOVERY_DOCS = ['https://www.googleapis.com/discovery/v1/apis/drive/v3/rest'];
        const SCOPES = 'https://www.googleapis.com/auth/drive.file';

        let accessToken = null;
        let tokenClient;

        // Birth date
        const birthDate = new Date('2025-09-30');
        
        // Calculate days
        function calculateDays() {
            const today = new Date();
            const diffTime = Math.abs(today - birthDate);
            const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
            return diffDays;
        }

        // Update days counter
        document.getElementById('daysCount').textContent = calculateDays();

        // Milestones data
        const milestones = [
            { name: '1Ïùº', days: 1, icon: 'üë∂' },
            { name: '50Ïùº', days: 50, icon: 'üéà' },
            { name: '100Ïùº', days: 100, icon: 'üéâ' },
            { name: '200Ïùº', days: 200, icon: 'üåü' },
            { name: '300Ïùº', days: 300, icon: 'üéä' },
            { name: 'Ï≤´ Îèå', days: 365, icon: 'üéÇ' }
        ];

        // Storage for milestone photos and timeline
        let milestonePhotos = {};
        let timelineEvents = [
            { date: '2025-09-30', text: 'Ï±ÑÏõêÏù¥Í∞Ä ÏÑ∏ÏÉÅÏóê ÌÉúÏñ¥ÎÇ¨Ïñ¥Ïöî! üë∂' }
        ];
        let galleryItems = [];
        let currentPage = 1;
        const itemsPerPage = 10;

        // Google Sign In
        function handleGoogleLogin() {
            tokenClient = google.accounts.oauth2.initTokenClient({
                client_id: GOOGLE_CLIENT_ID,
                scope: SCOPES,
                callback: (tokenResponse) => {
                    accessToken = tokenResponse.access_token;
                    document.getElementById('loginScreen').style.display = 'none';
                    document.getElementById('mainContent').classList.add('show');
                    loadAllData();
                },
            });
            tokenClient.requestAccessToken();
        }

        function handleLogout() {
            if (accessToken) {
                google.accounts.oauth2.revoke(accessToken);
                accessToken = null;
            }
            document.getElementById('loginScreen').style.display = 'flex';
            document.getElementById('mainContent').classList.remove('show');
        }

        // Load all data from Google Drive
        async function loadAllData() {
            document.getElementById('galleryLoading').style.display = 'block';
            
            try {
                // Load config file (milestone photos, timeline, gallery metadata)
                const galleryMeta = await loadConfigFile();
                
                // Load gallery files
                await loadGalleryFiles();
                
                // Merge metadata with gallery items
                if (galleryMeta.length > 0) {
                    galleryItems.forEach(item => {
                        const meta = galleryMeta.find(m => m.driveId === item.driveId);
                        if (meta) {
                            item.date = meta.date;
                            item.caption = meta.caption;
                        }
                    });
                    
                    // Sort by metadata order
                    const orderedItems = [];
                    galleryMeta.forEach(meta => {
                        const item = galleryItems.find(i => i.driveId === meta.driveId);
                        if (item) orderedItems.push(item);
                    });
                    // Add any new items not in metadata
                    galleryItems.forEach(item => {
                        if (!orderedItems.find(i => i.driveId === item.driveId)) {
                            orderedItems.push(item);
                        }
                    });
                    galleryItems = orderedItems;
                }
                
                // Render everything
                renderMilestones();
                renderTimeline();
                renderGallery(1);
                renderSlideshow();
            } catch (error) {
                console.error('Îç∞Ïù¥ÌÑ∞ Î°úÎìú Ïã§Ìå®:', error);
            } finally {
                document.getElementById('galleryLoading').style.display = 'none';
            }
        }

        // Load config file (milestone photos + timeline + gallery metadata)
        async function loadConfigFile() {
            try {
                const response = await fetch(
                    `https://www.googleapis.com/drive/v3/files?q=name='chaewon_config.json' and '${GOOGLE_FOLDER_ID}' in parents&fields=files(id)`,
                    {
                        headers: {
                            'Authorization': `Bearer ${accessToken}`
                        }
                    }
                );
                
                const data = await response.json();
                
                if (data.files && data.files.length > 0) {
                    const fileId = data.files[0].id;
                    const fileResponse = await fetch(
                        `https://www.googleapis.com/drive/v3/files/${fileId}?alt=media`,
                        {
                            headers: {
                                'Authorization': `Bearer ${accessToken}`
                            }
                        }
                    );
                    
                    const config = await fileResponse.json();
                    milestonePhotos = config.milestonePhotos || {};
                    timelineEvents = config.timelineEvents || timelineEvents;
                    
                    // Load gallery metadata and merge with loaded files
                    const galleryMeta = config.galleryMetadata || [];
                    return galleryMeta;
                }
            } catch (error) {
                console.log('ÏÑ§Ï†ï ÌååÏùº ÏóÜÏùå, ÏÉàÎ°ú ÏÉùÏÑ±Ìï©ÎãàÎã§');
            }
            return [];
        }

        // Save config file
        async function saveConfigFile() {
            const config = {
                milestonePhotos,
                timelineEvents
            };
            
            try {
                const blob = new Blob([JSON.stringify(config)], { type: 'application/json' });
                
                // Check if file exists
                const searchResponse = await fetch(
                    `https://www.googleapis.com/drive/v3/files?q=name='chaewon_config.json' and '${GOOGLE_FOLDER_ID}' in parents&fields=files(id)`,
                    {
                        headers: {
                            'Authorization': `Bearer ${accessToken}`
                        }
                    }
                );
                
                if (!searchResponse.ok) {
                    throw new Error('ÌååÏùº Í≤ÄÏÉâ Ïã§Ìå®: ' + searchResponse.statusText);
                }
                
                const searchData = await searchResponse.json();
                
                if (searchData.files && searchData.files.length > 0) {
                    // Load existing config to preserve gallery metadata
                    const fileId = searchData.files[0].id;
                    const existingResponse = await fetch(
                        `https://www.googleapis.com/drive/v3/files/${fileId}?alt=media`,
                        {
                            headers: {
                                'Authorization': `Bearer ${accessToken}`
                            }
                        }
                    );
                    
                    let existingConfig = {};
                    try {
                        existingConfig = await existingResponse.json();
                    } catch(e) {
                        console.log('Í∏∞Ï°¥ ÏÑ§Ï†ï ÌååÏùº ÌååÏã± Ïã§Ìå®, ÏÉàÎ°ú ÏÉùÏÑ±');
                    }
                    
                    // Merge with existing gallery metadata
                    config.galleryMetadata = existingConfig.galleryMetadata || [];
                    
                    // Update existing file - don't include parents
                    const metadata = {
                        name: 'chaewon_config.json',
                        mimeType: 'application/json'
                    };
                    
                    const newBlob = new Blob([JSON.stringify(config)], { type: 'application/json' });
                    const form = new FormData();
                    form.append('metadata', new Blob([JSON.stringify(metadata)], { type: 'application/json' }));
                    form.append('file', newBlob);
                    
                    const uploadResponse = await fetch(
                        `https://www.googleapis.com/upload/drive/v3/files/${fileId}?uploadType=multipart`,
                        {
                            method: 'PATCH',
                            headers: {
                                'Authorization': `Bearer ${accessToken}`
                            },
                            body: form
                        }
                    );
                    
                    if (!uploadResponse.ok) {
                        const errorText = await uploadResponse.text();
                        throw new Error('ÌååÏùº ÏóÖÎç∞Ïù¥Ìä∏ Ïã§Ìå®: ' + uploadResponse.status + ' - ' + errorText);
                    }
                } else {
                    // Create new file - include parents
                    const metadata = {
                        name: 'chaewon_config.json',
                        mimeType: 'application/json',
                        parents: [GOOGLE_FOLDER_ID]
                    };
                    
                    const form = new FormData();
                    form.append('metadata', new Blob([JSON.stringify(metadata)], { type: 'application/json' }));
                    form.append('file', blob);
                    
                    const uploadResponse = await fetch(
                        'https://www.googleapis.com/upload/drive/v3/files?uploadType=multipart',
                        {
                            method: 'POST',
                            headers: {
                                'Authorization': `Bearer ${accessToken}`
                            },
                            body: form
                        }
                    );
                    
                    if (!uploadResponse.ok) {
                        const errorText = await uploadResponse.text();
                        throw new Error('ÌååÏùº ÏÉùÏÑ± Ïã§Ìå®: ' + uploadResponse.status + ' - ' + errorText);
                    }
                }
                
                console.log('ÏÑ§Ï†ï ÌååÏùº Ï†ÄÏû• ÏÑ±Í≥µ!');
            } catch (error) {
                console.error('ÏÑ§Ï†ï ÌååÏùº Ï†ÄÏû• Ïò§Î•ò:', error);
                alert('ÏÑ§Ï†ïÏùÑ Ï†ÄÏû•ÌïòÎäîÎç∞ Ïã§Ìå®ÌñàÏäµÎãàÎã§.\n\nÏò§Î•ò: ' + error.message);
            }
        }

        // Load gallery files from Google Drive
        async function loadGalleryFiles() {
            try {
                const response = await fetch(
                    `https://www.googleapis.com/drive/v3/files?q='${GOOGLE_FOLDER_ID}' in parents and (mimeType contains 'image/' or mimeType contains 'video/')&fields=files(id,name,mimeType,createdTime,webContentLink)`,
                    {
                        headers: {
                            'Authorization': `Bearer ${accessToken}`
                        }
                    }
                );
                
                const data = await response.json();
                
                if (data.files) {
                    galleryItems = await Promise.all(data.files.map(async (file) => {
                        // Get file thumbnail/content
                        const fileUrl = `https://www.googleapis.com/drive/v3/files/${file.id}?alt=media`;
                        
                        return {
                            id: file.id,
                            type: file.mimeType.startsWith('image/') ? 'image' : 'video',
                            data: fileUrl,
                            date: file.createdTime,
                            caption: file.name.replace(/\.[^/.]+$/, ''), // Remove extension
                            driveId: file.id
                        };
                    }));
                }
            } catch (error) {
                console.error('Í∞§Îü¨Î¶¨ Î°úÎìú Ïã§Ìå®:', error);
            }
        }

        // Upload file to Google Drive
        async function uploadToGoogleDrive(file, compressedData) {
            try {
                const metadata = {
                    name: `chaewon_${Date.now()}_${file.name}`,
                    mimeType: file.type,
                    parents: [GOOGLE_FOLDER_ID]
                };
                
                // Convert base64 to blob
                const base64Data = compressedData.split(',')[1];
                const byteCharacters = atob(base64Data);
                const byteNumbers = new Array(byteCharacters.length);
                for (let i = 0; i < byteCharacters.length; i++) {
                    byteNumbers[i] = byteCharacters.charCodeAt(i);
                }
                const byteArray = new Uint8Array(byteNumbers);
                const blob = new Blob([byteArray], { type: file.type });
                
                const form = new FormData();
                form.append('metadata', new Blob([JSON.stringify(metadata)], { type: 'application/json' }));
                form.append('file', blob);
                
                const response = await fetch(
                    'https://www.googleapis.com/upload/drive/v3/files?uploadType=multipart&fields=id,name,mimeType,createdTime',
                    {
                        method: 'POST',
                        headers: {
                            'Authorization': `Bearer ${accessToken}`
                        },
                        body: form
                    }
                );
                
                if (!response.ok) {
                    const errorText = await response.text();
                    throw new Error('ÏóÖÎ°úÎìú Ïã§Ìå®: ' + response.status + ' - ' + errorText);
                }
                
                const uploadedFile = await response.json();
                
                // Automatically share the uploaded file with "anyone with the link"
                try {
                    await fetch(
                        `https://www.googleapis.com/drive/v3/files/${uploadedFile.id}/permissions`,
                        {
                            method: 'POST',
                            headers: {
                                'Authorization': `Bearer ${accessToken}`,
                                'Content-Type': 'application/json'
                            },
                            body: JSON.stringify({
                                type: 'anyone',
                                role: 'reader'
                            })
                        }
                    );
                    console.log('ÌååÏùº Í≥µÏú† ÏÑ§Ï†ï ÏôÑÎ£å:', uploadedFile.name);
                } catch (permError) {
                    console.warn('Í≥µÏú† ÏÑ§Ï†ï Ïã§Ìå® (ÌååÏùºÏùÄ ÏóÖÎ°úÎìúÎê®):', permError);
                }
                
                return uploadedFile;
            } catch (error) {
                console.error('Google Drive ÏóÖÎ°úÎìú Ïò§Î•ò:', error);
                alert('ÌååÏùº ÏóÖÎ°úÎìúÏóê Ïã§Ìå®ÌñàÏäµÎãàÎã§.\n\nÏò§Î•ò: ' + error.message + '\n\nÍµ¨Í∏Ä ÎìúÎùºÏù¥Î∏å Ìè¥Îçî Í∂åÌïúÏùÑ ÌôïÏù∏Ìï¥Ï£ºÏÑ∏Ïöî.');
                throw error;
            }
        }

        // Image compression function
        function compressImage(file, maxWidth = 1200, quality = 0.8) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.onload = function(e) {
                    const img = new Image();
                    img.onload = function() {
                        const canvas = document.createElement('canvas');
                        let width = img.width;
                        let height = img.height;
                        
                        if (width > maxWidth) {
                            height = (height * maxWidth) / width;
                            width = maxWidth;
                        }
                        
                        canvas.width = width;
                        canvas.height = height;
                        
                        const ctx = canvas.getContext('2d');
                        ctx.drawImage(img, 0, 0, width, height);
                        
                        const compressed = canvas.toDataURL('image/jpeg', quality);
                        resolve(compressed);
                    };
                    img.onerror = reject;
                    img.src = e.target.result;
                };
                reader.onerror = reject;
                reader.readAsDataURL(file);
            });
        }

        // File upload handler
        document.getElementById('fileInput').addEventListener('change', async function(e) {
            const files = e.target.files;
            document.getElementById('galleryLoading').style.display = 'block';
            
            for (let file of files) {
                try {
                    if (file.type.startsWith('image/')) {
                        const compressed = await compressImage(file);
                        const uploadedFile = await uploadToGoogleDrive(file, compressed);
                        
                        galleryItems.unshift({
                            id: uploadedFile.id,
                            type: 'image',
                            data: `https://www.googleapis.com/drive/v3/files/${uploadedFile.id}?alt=media`,
                            date: uploadedFile.createdTime,
                            caption: '',
                            driveId: uploadedFile.id
                        });
                    }
                } catch (error) {
                    console.error('ÏóÖÎ°úÎìú Ïã§Ìå®:', error);
                    alert('ÌååÏùº ÏóÖÎ°úÎìúÏóê Ïã§Ìå®ÌñàÏäµÎãàÎã§: ' + error.message);
                }
            }
            
            document.getElementById('galleryLoading').style.display = 'none';
            renderGallery(1);
            renderSlideshow();
            
            // Clear the file input
            e.target.value = '';
        });

        // Render milestones
        async function renderMilestones() {
            const grid = document.getElementById('milestoneGrid');
            grid.innerHTML = '';
            const currentDays = calculateDays();
            
            for (let index = 0; index < milestones.length; index++) {
                const milestone = milestones[index];
                const milestoneDate = new Date(birthDate);
                milestoneDate.setDate(milestoneDate.getDate() + milestone.days);
                
                const daysUntil = milestone.days - currentDays;
                const status = daysUntil > 0 ? `D-${daysUntil}` : daysUntil === 0 ? 'Ïò§Îäò!' : 'ÏßÄÎÇ®';
                
                const card = document.createElement('div');
                card.className = 'milestone-card';
                card.onclick = () => showMilestoneModal(index);

                // Í∏∞ÎÖêÏùº ÏÇ¨ÏßÑÏù¥ ÏûàÏúºÎ©¥ Ïù∏Ï¶ùÎêú blob URLÎ°ú Î≥ÄÌôò
                let photoHTML = '';
                if (milestonePhotos[index]) {
                    let photoSrc = milestonePhotos[index];
                    // Drive URLÏù¥Î©¥ Ïù∏Ï¶ù ÌïÑÏöî, base64Ïù¥Î©¥ Í∑∏ÎåÄÎ°ú ÏÇ¨Ïö©
                    if (photoSrc.startsWith('https://') && accessToken) {
                        photoSrc = await getAuthedImageUrl(photoSrc) || '';
                    }
                    if (photoSrc) {
                        photoHTML = `<img src="${photoSrc}" class="milestone-photo">`;
                    }
                }
                
                card.innerHTML = `
                    ${photoHTML}
                    <button class="milestone-edit-btn" onclick="event.stopPropagation(); showMilestoneModal(${index})">üì∑</button>
                    <div class="milestone-content">
                        <div class="milestone-icon">${milestone.icon}</div>
                        <div class="milestone-name">${milestone.name}</div>
                        <div class="milestone-date">${milestoneDate.toLocaleDateString('ko-KR')}</div>
                        <div class="milestone-days">${status}</div>
                    </div>
                `;
                grid.appendChild(card);
            }
        }

        // Render gallery
        // Fetch image from Drive with auth and return blob URL
        const imageUrlCache = {};
        
        async function getAuthedImageUrl(driveUrl) {
            // Check cache first
            if (imageUrlCache[driveUrl]) {
                return imageUrlCache[driveUrl];
            }
            
            try {
                // Extract file ID from Drive URL (supports multiple formats)
                let fileId = null;
                
                // Format 1: https://www.googleapis.com/drive/v3/files/FILE_ID?alt=media
                const apiMatch = driveUrl.match(/\/files\/([^/?]+)/);
                if (apiMatch) {
                    fileId = apiMatch[1];
                }
                
                // Format 2: https://drive.google.com/file/d/FILE_ID/view
                const driveMatch = driveUrl.match(/\/d\/([^/?]+)/);
                if (!fileId && driveMatch) {
                    fileId = driveMatch[1];
                }
                
                if (!fileId) {
                    console.error('Invalid Drive URL:', driveUrl);
                    return null;
                }
                
                // Try multiple URL formats
                // Format 1: Direct download link
                const downloadUrl = `https://drive.google.com/uc?export=download&id=${fileId}`;
                
                // Format 2: Thumbnail (more reliable for embedding)
                const thumbnailUrl = `https://drive.google.com/thumbnail?id=${fileId}&sz=w2000`;
                
                // Use thumbnail URL (works better for external embedding)
                imageUrlCache[driveUrl] = thumbnailUrl;
                return thumbnailUrl;
                
            } catch (e) {
                console.error('Ïù¥ÎØ∏ÏßÄ URL Î≥ÄÌôò Ïã§Ìå®:', e);
                return null;
            }
        }

        async function renderGallery(page = 1) {
            const grid = document.getElementById('galleryGrid');
            grid.innerHTML = '';
            
            currentPage = page;
            
            // Filter out undefined/null items
            galleryItems = galleryItems.filter(item => item !== undefined && item !== null);
            
            // Calculate pagination
            const startIndex = (page - 1) * itemsPerPage;
            const endIndex = startIndex + itemsPerPage;
            const pageItems = galleryItems.slice(startIndex, endIndex);
            
            for (let i = 0; i < pageItems.length; i++) {
                const item = pageItems[i];
                const actualIndex = startIndex + i;
                const div = document.createElement('div');
                div.className = 'gallery-item';
                div.draggable = true;
                div.dataset.index = actualIndex;

                let mediaSrc = '';
                if (item.type === 'image' && accessToken && item.data.startsWith('https://')) {
                    mediaSrc = await getAuthedImageUrl(item.data) || '';
                } else {
                    mediaSrc = item.data;
                }

                const mediaElement = item.type === 'image'
                    ? `<img src="${mediaSrc}" alt="Ï±ÑÏõêÏù¥ ÏÇ¨ÏßÑ" referrerpolicy="no-referrer">`
                    : `<video src="${mediaSrc}" controls></video>`;
                
                div.innerHTML = `
                    ${mediaElement}
                    <button class="gallery-edit-btn" onclick="event.stopPropagation(); editGalleryItem(${actualIndex})">‚úèÔ∏è</button>
                    <button class="gallery-delete-btn" onclick="event.stopPropagation(); deleteGalleryItem(${actualIndex})">üóëÔ∏è</button>
                    <div class="gallery-info">
                        <div class="gallery-date">${new Date(item.date).toLocaleDateString('ko-KR')}</div>
                        <div class="gallery-caption">${item.caption || 'ÏÜåÏ§ëÌïú ÏàúÍ∞Ñ'}</div>
                    </div>
                `;
                
                // Drag and drop event listeners
                div.addEventListener('dragstart', handleDragStart);
                div.addEventListener('dragend', handleDragEnd);
                div.addEventListener('dragover', handleDragOver);
                div.addEventListener('drop', handleDrop);
                div.addEventListener('dragleave', handleDragLeave);
                
                grid.appendChild(div);
            }
            
            renderPagination();
        }

        function renderPagination() {
            const pagination = document.getElementById('galleryPagination');
            if (!pagination) return;
            
            pagination.innerHTML = '';
            
            const totalPages = Math.ceil(galleryItems.length / itemsPerPage);
            
            if (totalPages <= 1) return; // Don't show pagination if only 1 page
            
            // Previous button
            const prevBtn = document.createElement('button');
            prevBtn.className = 'page-btn';
            prevBtn.textContent = '‚Äπ';
            prevBtn.disabled = currentPage === 1;
            prevBtn.onclick = () => renderGallery(currentPage - 1);
            pagination.appendChild(prevBtn);
            
            // Page numbers
            for (let i = 1; i <= totalPages; i++) {
                if (i === 1 || i === totalPages || (i >= currentPage - 2 && i <= currentPage + 2)) {
                    const pageBtn = document.createElement('button');
                    pageBtn.className = 'page-btn' + (i === currentPage ? ' active' : '');
                    pageBtn.textContent = i;
                    pageBtn.onclick = () => renderGallery(i);
                    pagination.appendChild(pageBtn);
                } else if (i === currentPage - 3 || i === currentPage + 3) {
                    const dots = document.createElement('span');
                    dots.textContent = '...';
                    dots.style.padding = '0 10px';
                    pagination.appendChild(dots);
                }
            }
            
            // Next button
            const nextBtn = document.createElement('button');
            nextBtn.className = 'page-btn';
            nextBtn.textContent = '‚Ä∫';
            nextBtn.disabled = currentPage === totalPages;
            nextBtn.onclick = () => renderGallery(currentPage + 1);
            pagination.appendChild(nextBtn);
        }

        // Drag and Drop handlers
        let draggedIndex = null;
        let draggedElement = null;

        function handleDragStart(e) {
            draggedIndex = parseInt(e.currentTarget.dataset.index);
            draggedElement = e.currentTarget;
            e.currentTarget.classList.add('dragging');
            e.dataTransfer.effectAllowed = 'move';
        }

        function handleDragEnd(e) {
            e.currentTarget.classList.remove('dragging');
            document.querySelectorAll('.gallery-item').forEach(item => {
                item.classList.remove('drag-over');
            });
        }

        function handleDragOver(e) {
            e.preventDefault();
            e.dataTransfer.dropEffect = 'move';
            const dropTarget = e.target.closest('.gallery-item');
            if (dropTarget && dropTarget !== draggedElement) {
                dropTarget.classList.add('drag-over');
            }
        }

        function handleDragLeave(e) {
            const dropTarget = e.target.closest('.gallery-item');
            if (dropTarget) {
                dropTarget.classList.remove('drag-over');
            }
        }

        function handleDrop(e) {
            e.preventDefault();
            e.stopPropagation();
            
            const dropTarget = e.target.closest('.gallery-item');
            if (!dropTarget || dropTarget === draggedElement) return;
            
            const dropIndex = parseInt(dropTarget.dataset.index);
            
            if (draggedIndex !== null && !isNaN(dropIndex) && draggedIndex !== dropIndex) {
                // Get the grid container
                const grid = document.getElementById('galleryGrid');
                
                // Reorder DOM elements visually
                if (draggedIndex < dropIndex) {
                    // Moving down
                    dropTarget.parentNode.insertBefore(draggedElement, dropTarget.nextSibling);
                } else {
                    // Moving up
                    dropTarget.parentNode.insertBefore(draggedElement, dropTarget);
                }
                
                // Update data array
                const draggedItem = galleryItems[draggedIndex];
                galleryItems.splice(draggedIndex, 1);
                galleryItems.splice(dropIndex, 0, draggedItem);
                
                // Update all data-index attributes
                const items = grid.querySelectorAll('.gallery-item');
                items.forEach((item, idx) => {
                    item.dataset.index = idx;
                });
                
                // Save to Drive in background (don't wait)
                saveGalleryMetadata().catch(err => console.error('Ï†ÄÏû• Ïã§Ìå®:', err));
            }
            
            dropTarget.classList.remove('drag-over');
        }

        // Edit gallery item
        let editingGalleryIndex = null;

        function editGalleryItem(index) {
            editingGalleryIndex = index;
            const item = galleryItems[index];
            
            document.getElementById('galleryEditModalTitle').textContent = 'ÏÇ¨ÏßÑ Ï†ïÎ≥¥ ÏàòÏ†ï';
            document.getElementById('galleryEditDate').value = item.date.split('T')[0];
            document.getElementById('galleryEditCaption').value = item.caption || '';
            document.getElementById('galleryEditModal').classList.add('show');
        }

        function closeGalleryEditModal() {
            document.getElementById('galleryEditModal').classList.remove('show');
            editingGalleryIndex = null;
        }

        async function saveGalleryEdit() {
            if (editingGalleryIndex === null) return;
            
            const date = document.getElementById('galleryEditDate').value;
            const caption = document.getElementById('galleryEditCaption').value;
            
            if (!date) {
                alert('ÎÇ†ÏßúÎ•º ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî!');
                return;
            }
            
            galleryItems[editingGalleryIndex].date = new Date(date).toISOString();
            galleryItems[editingGalleryIndex].caption = caption;
            
            await saveGalleryMetadata();
            
            renderGallery(currentPage);
            renderSlideshow();
            closeGalleryEditModal();
        }

        // Delete gallery item
        async function deleteGalleryItem(index) {
            if (!confirm('Ïù¥ ÏÇ¨ÏßÑÏùÑ ÏÇ≠Ï†úÌïòÏãúÍ≤†Ïñ¥Ïöî?')) return;
            
            const item = galleryItems[index];
            if (!item) return;
            
            // Delete from Google Drive if it has driveId
            if (item.driveId && accessToken) {
                try {
                    await fetch(`https://www.googleapis.com/drive/v3/files/${item.driveId}`, {
                        method: 'DELETE',
                        headers: {
                            'Authorization': `Bearer ${accessToken}`
                        }
                    });
                } catch (error) {
                    console.error('Drive ÌååÏùº ÏÇ≠Ï†ú Ïã§Ìå®:', error);
                }
            }
            
            galleryItems.splice(index, 1);
            
            // Filter out undefined values
            galleryItems = galleryItems.filter(item => item !== undefined && item !== null);
            
            await saveGalleryMetadata();
            
            renderGallery(currentPage);
            renderSlideshow();
        }

        // Save gallery metadata (captions, dates, order) to config file
        async function saveGalleryMetadata() {
            // Filter out undefined/null items first
            galleryItems = galleryItems.filter(item => item !== undefined && item !== null);
            
            const galleryMeta = galleryItems.map(item => ({
                id: item.id || Date.now() + Math.random(),
                driveId: item.driveId || null,
                date: item.date || new Date().toISOString(),
                caption: item.caption || ''
            }));
            
            // Save to config file along with other data
            const config = {
                milestonePhotos,
                timelineEvents,
                galleryMetadata: galleryMeta
            };
            
            try {
                const blob = new Blob([JSON.stringify(config)], { type: 'application/json' });
                
                const searchResponse = await fetch(
                    `https://www.googleapis.com/drive/v3/files?q=name='chaewon_config.json' and '${GOOGLE_FOLDER_ID}' in parents&fields=files(id)`,
                    {
                        headers: {
                            'Authorization': `Bearer ${accessToken}`
                        }
                    }
                );
                
                const searchData = await searchResponse.json();
                
                if (searchData.files && searchData.files.length > 0) {
                    const fileId = searchData.files[0].id;
                    const metadata = {
                        name: 'chaewon_config.json',
                        mimeType: 'application/json'
                    };
                    
                    const form = new FormData();
                    form.append('metadata', new Blob([JSON.stringify(metadata)], { type: 'application/json' }));
                    form.append('file', blob);
                    
                    await fetch(
                        `https://www.googleapis.com/upload/drive/v3/files/${fileId}?uploadType=multipart`,
                        {
                            method: 'PATCH',
                            headers: {
                                'Authorization': `Bearer ${accessToken}`
                            },
                            body: form
                        }
                    );
                } else {
                    const metadata = {
                        name: 'chaewon_config.json',
                        mimeType: 'application/json',
                        parents: [GOOGLE_FOLDER_ID]
                    };
                    
                    const form = new FormData();
                    form.append('metadata', new Blob([JSON.stringify(metadata)], { type: 'application/json' }));
                    form.append('file', blob);
                    
                    await fetch(
                        'https://www.googleapis.com/upload/drive/v3/files?uploadType=multipart',
                        {
                            method: 'POST',
                            headers: {
                                'Authorization': `Bearer ${accessToken}`
                            },
                            body: form
                        }
                    );
                }
                
                console.log('Í∞§Îü¨Î¶¨ Î©îÌÉÄÎç∞Ïù¥ÌÑ∞ Ï†ÄÏû• ÏÑ±Í≥µ!');
            } catch (error) {
                console.error('Í∞§Îü¨Î¶¨ Î©îÌÉÄÎç∞Ïù¥ÌÑ∞ Ï†ÄÏû• Ïã§Ìå®:', error);
            }
        }

        // Render timeline
        function renderTimeline() {
            const container = document.getElementById('timelineContainer');
            container.innerHTML = '';
            
            timelineEvents.sort((a, b) => new Date(b.date) - new Date(a.date)).forEach((event, index) => {
                const div = document.createElement('div');
                div.className = 'timeline-item';
                div.innerHTML = `
                    <div class="timeline-content">
                        <div class="timeline-edit-btns">
                            <button class="timeline-edit-btn" onclick="editTimelineEvent(${index})">‚úèÔ∏è</button>
                            <button class="timeline-delete-btn" onclick="deleteTimelineEvent(${index})">üóëÔ∏è</button>
                        </div>
                        <div class="timeline-date">${new Date(event.date).toLocaleDateString('ko-KR')}</div>
                        <div class="timeline-text">${event.text}</div>
                    </div>
                    <div class="timeline-dot"></div>
                `;
                container.appendChild(div);
            });
        }

        // Milestone modal functions
        let currentMilestoneIndex = null;

        function showMilestoneModal(index) {
            currentMilestoneIndex = index;
            const modal = document.getElementById('milestoneModal');
            const preview = document.getElementById('milestonePhotoPreview');
            
            if (milestonePhotos[index]) {
                preview.src = milestonePhotos[index];
                preview.style.display = 'block';
            } else {
                preview.style.display = 'none';
            }
            
            modal.classList.add('show');
        }

        function closeMilestoneModal() {
            document.getElementById('milestoneModal').classList.remove('show');
            document.getElementById('milestonePhotoPreview').style.display = 'none';
            currentMilestoneIndex = null;
        }

        document.getElementById('milestonePhotoInput').addEventListener('change', function(e) {
            const file = e.target.files[0];
            if (file) {
                const preview = document.getElementById('milestonePhotoPreview');
                preview.style.display = 'block';
                preview.alt = 'ÏïïÏ∂ï Ï§ë...';
                
                compressImage(file, 800, 0.7).then(compressed => {
                    preview.src = compressed;
                    preview.alt = 'ÏÇ¨ÏßÑ ÎØ∏Î¶¨Î≥¥Í∏∞';
                }).catch(error => {
                    console.error('Ïù¥ÎØ∏ÏßÄ ÏïïÏ∂ï Ïã§Ìå®:', error);
                    alert('ÏÇ¨ÏßÑ Ï≤òÎ¶¨Ïóê Ïã§Ìå®ÌñàÏäµÎãàÎã§. Îã§Ïãú ÏãúÎèÑÌï¥Ï£ºÏÑ∏Ïöî.');
                    preview.style.display = 'none';
                });
            }
        });

        async function saveMilestonePhoto() {
            const preview = document.getElementById('milestonePhotoPreview');
            if (preview.src && preview.src.startsWith('data:') && currentMilestoneIndex !== null) {
                milestonePhotos[currentMilestoneIndex] = preview.src;
                await saveConfigFile();
                renderMilestones();
                closeMilestoneModal();
            } else {
                alert('ÏÇ¨ÏßÑÏùÑ ÏÑ†ÌÉùÌï¥Ï£ºÏÑ∏Ïöî!');
            }
        }

        // Timeline modal functions
        let editingTimelineIndex = null;

        function showAddTimelineModal() {
            editingTimelineIndex = null;
            document.getElementById('timelineModalTitle').textContent = 'Ïù¥ÏïºÍ∏∞ Ï∂îÍ∞Ä';
            document.getElementById('timelineDate').value = new Date().toISOString().split('T')[0];
            document.getElementById('timelineText').value = '';
            document.getElementById('timelineModal').classList.add('show');
        }

        function editTimelineEvent(index) {
            editingTimelineIndex = index;
            const event = timelineEvents[index];
            document.getElementById('timelineModalTitle').textContent = 'Ïù¥ÏïºÍ∏∞ ÏàòÏ†ï';
            document.getElementById('timelineDate').value = event.date;
            document.getElementById('timelineText').value = event.text;
            document.getElementById('timelineModal').classList.add('show');
        }

        async function deleteTimelineEvent(index) {
            if (confirm('Ïù¥ Ïù¥ÏïºÍ∏∞Î•º ÏÇ≠Ï†úÌïòÏãúÍ≤†Ïñ¥Ïöî?')) {
                timelineEvents.splice(index, 1);
                await saveConfigFile();
                renderTimeline();
            }
        }

        function closeTimelineModal() {
            document.getElementById('timelineModal').classList.remove('show');
            editingTimelineIndex = null;
        }

        async function saveTimelineEvent() {
            const date = document.getElementById('timelineDate').value;
            const text = document.getElementById('timelineText').value;
            
            if (!date || !text) {
                alert('ÎÇ†ÏßúÏôÄ ÎÇ¥Ïö©ÏùÑ Î™®Îëê ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî!');
                return;
            }
            
            if (editingTimelineIndex !== null) {
                timelineEvents[editingTimelineIndex] = { date, text };
            } else {
                timelineEvents.push({ date, text });
            }
            
            await saveConfigFile();
            renderTimeline();
            closeTimelineModal();
        }

        // Close modals when clicking outside
        window.onclick = function(event) {
            if (event.target.classList.contains('modal')) {
                event.target.classList.remove('show');
            }
        };

        // Photo Slideshow
        let currentSlide = 0;
        let slideshowInterval;

        async function renderSlideshow() {
            const container = document.getElementById('slideshowContainer');
            const dotsContainer = document.getElementById('slideDots');
            
            // Filter out undefined/null items
            galleryItems = galleryItems.filter(item => item !== undefined && item !== null);
            
            const images = galleryItems.filter(item => item && item.type === 'image');
            
            const navButtons = container.querySelectorAll('.slide-nav');
            container.innerHTML = '';
            navButtons.forEach(btn => container.appendChild(btn));
            dotsContainer.innerHTML = '';
            
            if (images.length === 0) {
                const placeholder = document.createElement('div');
                placeholder.className = 'slide active';
                placeholder.innerHTML = `
                    <div class="slide-placeholder">
                        <div class="slide-placeholder-icon">üì∏</div>
                        <div class="slide-placeholder-text">ÏÇ¨ÏßÑÏùÑ ÏóÖÎ°úÎìúÌïòÎ©¥ Ïó¨Í∏∞Ïóê ÎÇòÌÉÄÎÇòÏöî!</div>
                    </div>
                `;
                container.insertBefore(placeholder, container.firstChild);
                return;
            }
            
            for (let index = 0; index < images.length; index++) {
                const image = images[index];
                const slide = document.createElement('div');
                slide.className = 'slide' + (index === 0 ? ' active' : '');
                
                const img = document.createElement('img');
                img.alt = `Ï±ÑÏõêÏù¥ ÏÇ¨ÏßÑ ${index + 1}`;
                img.referrerPolicy = 'no-referrer';

                if (accessToken && image.data && image.data.startsWith('https://')) {
                    img.src = await getAuthedImageUrl(image.data) || '';
                } else {
                    img.src = image.data || '';
                }
                
                slide.appendChild(img);
                container.insertBefore(slide, container.firstChild);
                
                const dot = document.createElement('span');
                dot.className = 'dot' + (index === 0 ? ' active' : '');
                dot.onclick = () => goToSlide(index);
                dotsContainer.appendChild(dot);
            }
            
            startSlideshow();
        }

        function changeSlide(direction) {
            const images = galleryItems.filter(item => item.type === 'image');
            if (images.length === 0) return;
            
            currentSlide += direction;
            if (currentSlide >= images.length) currentSlide = 0;
            if (currentSlide < 0) currentSlide = images.length - 1;
            
            showSlide(currentSlide);
            resetSlideshow();
        }

        function goToSlide(index) {
            currentSlide = index;
            showSlide(currentSlide);
            resetSlideshow();
        }

        function showSlide(index) {
            const slides = document.querySelectorAll('.slide');
            const dots = document.querySelectorAll('.dot');
            
            slides.forEach((slide, i) => {
                slide.classList.toggle('active', i === index);
            });
            
            dots.forEach((dot, i) => {
                dot.classList.toggle('active', i === index);
            });
        }

        function startSlideshow() {
            slideshowInterval = setInterval(() => {
                const images = galleryItems.filter(item => item.type === 'image');
                if (images.length > 0) {
                    currentSlide = (currentSlide + 1) % images.length;
                    showSlide(currentSlide);
                }
            }, 4000);
        }

        function resetSlideshow() {
            clearInterval(slideshowInterval);
            startSlideshow();
        }

        // Smooth scroll
        document.querySelectorAll('a[href^="#"]').forEach(anchor => {
            anchor.addEventListener('click', function (e) {
                e.preventDefault();
                const target = document.querySelector(this.getAttribute('href'));
                if (target) {
                    target.scrollIntoView({ behavior: 'smooth' });
                }
            });
        });

        // Initialize
        renderMilestones();
        renderTimeline();
    </script>
</body>
</html>